{% extends 'GameBundle::layout.html.twig' %}

{% block title %}Adon Melech - Map view{% endblock %}

{% block content %}

    <div class="container-fluid">
        <!--- MAP CONTAINER --->

        <div class="row">
            <div class="col-md-12">
                <canvas height="500px" width="1200px" id="map" style="margin-left:-70px"></canvas>
            </div>
        </div>

        <!--- BOTTOM BAR --->

        <div class="row">
            <div class="col-md-3">
                <div class="panel panel-default">
                    <h4>[ContextName]</h4>
                    <p>[ContextProperties]</p>
                    <ul>
                        <li>[Key] => [Value]</li>
                    </ul>
                </div>
            </div>

            <div class="col-md-6">
                    <div class="panel panel-default">
                        <div class="row">
                            <div class="col-md-6">
                            <h4>Inspector</h4>
                            <small><p>[SelectedName]</p>
                                <p>[ContextProperties]</p>
                                <ul>
                                    <li>[Key] => [Value]</li>
                                </ul></small>
                            </div>
                            <div class="col-md-6 text-right">
                                <h4>Controls</h4>
                                <form name="inspector_controls" action="\control" method="post">
                                    <p>
                                        <input type="button" name="sample2" class="button btn-default" value="Trade">
                                        <input type="button" name="sample2" class="button btn-default" value="Diplomacy">
                                    </p>
                                    <p>
                                        <input type="button" name="sample1" class="button btn-default" value="Relationships">
                                        <input type="button" name="sample1" class="button btn-default" value="Detailed info">
                                    </p>
                                </form>
                            </div>
                        </div>
                    </div>
            </div>

            <div class="col-md-3 pull-right">
                <div class="panel panel-default">
                    <h4>News</h4>
                    <ul>
                        <li>[MostRecentItems]</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="{{ asset('js/bootstrap.js') }}" type="text/javascript"></script>
<script>
/*
Define the drawing functions
*/

$(function() {
    $.ajax({
        url: "/map",
        type: "GET",
        //data: "23",
        success: function (data) {
            var plains = new Image();
            plains.src = "\\tiles\\plains_tile.png";
            var hills = new Image();
            hills.src = "\\tiles\\hills_tile.png";
            var desert = new Image();
            desert.src = "\\tiles\\desert_tile.png";
            var mountains = new Image();
            mountains.src = "\\tiles\\mountains_tile.png";
            var swamp = new Image();
            swamp.src = "\\tiles\\swamp_tile.png";
            var forest = new Image();
            forest.src = "\\tiles\\forest_tile.png";
            var shallowsea = new Image();
            shallowsea.src = "\\tiles\\shallowsea_tile.png";
            var deepsea = new Image();
            deepsea.src = "\\tiles\\deepsea_tile.png";
            var city = new Image();
            city.src = "\\tiles\\city.png";
            var clan = new Image();
            clan.src = "\\tiles\\clan.png";

            var c = document.getElementById("map");
            var ctx = c.getContext("2d");
            ctx.beginPath();

            for (var i = 0; i < data['data'].length; i++) {
                var x2 = data['data'][i].x * plains.width;
                var y2 = data['data'][i].y * plains.height;
                var gt = data['data'][i].geotype;

                switch (gt) {
                    case 'plains':
                        ctx.drawImage(plains, x2, y2);
                        break;
                    case 'hills':
                        ctx.drawImage(hills, x2, y2);
                        break;
                    case 'mountains':
                        ctx.drawImage(mountains, x2, y2);
                        break;
                    case 'desert':
                        ctx.drawImage(desert, x2, y2);
                        break;
                    case 'swamp':
                        ctx.drawImage(swamp, x2, y2);
                        break;
                    case 'forest':
                        ctx.drawImage(forest, x2, y2);
                        break;
                    case 'deepsea':
                        ctx.drawImage(deepsea, x2, y2);
                        break;
                    case 'shallowsea':
                        ctx.drawImage(shallowsea, x2, y2);
                        break;
                }
            }

            if (data['cities'])
            {
                for(var n = 0; n < (data['cities'].length); n++)
                {
                    ctx.drawImage(city, (data['cities'][n].x * plains.width) + 25, (data['cities'][n].y * plains.height) + 25);
                    ctx.fillText(data['cities'][n].named, (data['cities'][n].x * plains.width) + 30, (data['cities'][n].y * plains.height) + 35);
                }
            }

            if (data['clans'])
            {
                for(var n = 0; n < (data['clans'].length); n++)
                {
                    var fx = Math.floor((Math.random() * 60) + -30);
                    var fy = Math.floor((Math.random() * 20) + 50);
                    ctx.drawImage(clan, (data['clans'][n].x * plains.width) + fx, (data['clans'][n].y * plains.height + fy));
                    ctx.fillText(data['clans'][n].named, (data['clans'][n].x * plains.width) + fx + 8, (data['clans'][n].y * plains.height) + fy + 10);
                }
            }

            console.log(data);
        }
    });
});
</script>

{% endblock %}